{% extends "base.html" %}

{% block content %}

<div class="card shadow-sm">
    <div class="card-body">

        <h4>Add Allocation</h4>
        <hr>

        <form method="POST" autocomplete="off">
            <div class="mb-3">
                <label class="form-label">Select Event</label>
                <select class="form-select" name="event_id">
                    <option value="">-- choose event --</option>
                    {% for e in events %}
                    <option value="{{ e.id }}">
                        {{ e.title }} ({{ e.start_time }} â†’ {{ e.end_time }})
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Select Resources</label>
                <div class="dropdown">
                    <button class="btn btn-light border dropdown-toggle w-100 text-start"
                            type="button"
                            data-bs-toggle="dropdown"
                            data-bs-auto-close="outside"
                            id="resourceDropdown">
                        Select Resources
                    </button>

                    <ul class="dropdown-menu w-100 p-2" style="max-height:250px;overflow-y:auto;">
                        {% for r in resources %}
                        <li>
                            <label class="d-flex align-items-center gap-2 px-2 py-1">
                                <input type="checkbox" name="resource_ids" value="{{ r.id }}"
                                       class="form-check-input resource-check">
                                <span>{{ r.name }} ({{ r.resource_type }})</span>
                            </label>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <button class="btn btn-primary">Allocate</button>
            <a href="/allocations" class="btn btn-secondary">Cancel</a>

        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const checks = document.querySelectorAll(".resource-check");
    const btn = document.getElementById("resourceDropdown");

    function updateLabel() {
        const selected = [];
        checks.forEach(x => {
            if (x.checked) selected.push(x.nextElementSibling.innerText.trim());
        });

        btn.innerText = selected.length ? selected.join(", ") : "Select Resources";
    }

    checks.forEach(c => c.addEventListener("change", updateLabel));
    updateLabel();
});
</script>

{% endblock %}
